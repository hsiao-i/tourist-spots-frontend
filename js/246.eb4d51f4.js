"use strict";(self["webpackChunkhexschool_project_frontend"]=self["webpackChunkhexschool_project_frontend"]||[]).push([[246],{9246:function(t,e,o){o.r(e),o.d(e,{default:function(){return f}});var s=o(6252),n=o(3577);const c={class:"container mt-5 min-vh-100"},r=(0,s._)("h2",null,"我的收藏",-1),i={key:0},a=(0,s._)("p",{class:"text-center text-secondary"},"目前無收藏",-1),l=[a],h={key:1,class:"table table-striped"},d=(0,s._)("thead",null,[(0,s._)("tr",null,[(0,s._)("th",{scope:"col",width:"100px"},"景點名稱"),(0,s._)("th",{scope:"col"},"描述"),(0,s._)("th",{scope:"col"},"圖片網址"),(0,s._)("th",{scope:"col"})])],-1),p={class:"text-end"},u=["onClick"];function k(t,e,o,a,k,g){const $=(0,s.up)("router-link");return(0,s.wg)(),(0,s.iD)("div",c,[r,0===k.favoriteSpots.length?((0,s.wg)(),(0,s.iD)("div",i,l)):((0,s.wg)(),(0,s.iD)("table",h,[d,(0,s._)("tbody",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(k.favoriteSpots,(t=>((0,s.wg)(),(0,s.iD)("tr",{key:t.id},[(0,s._)("td",null,[(0,s.Wm)($,{to:`/tourist-spot/${t.id}`},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(t.position),1)])),_:2},1032,["to"])]),(0,s._)("td",null,(0,n.zw)(t.description),1),(0,s._)("td",null,(0,n.zw)(t.img_url),1),(0,s._)("td",p,[(0,s._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:e=>g.deleteFavoriteSpot(t.id)},"刪除",8,u)])])))),128))])]))])}o(7658);var g={data(){return{favoriteSpots:[]}},methods:{getFavoriteSpots(){const t="https://tourist-spots-backend.onrender.com/api/get-favorite",e=document.cookie.replace(/(?:(?:^|.*;\s*)accessToken\s*=\s*([^;]*).*$)|^.*$/,"$1");e&&(this.$http.defaults.headers.common.Authorization=`Bearer ${e}`,this.$http.get(t).then((t=>{console.log(t),this.favoriteSpots=t.data.favorite})).catch((t=>{console.log(t)})))},deleteFavoriteSpot(t){const e=`https://tourist-spots-backend.onrender.com/api/delete-favorite/${t}`,o=document.cookie.replace(/(?:(?:^|.*;\s*)accessToken\s*=\s*([^;]*).*$)|^.*$/,"$1");o&&(this.$http.defaults.headers.common.Authorization=`Bearer ${o}`,this.$http.delete(e).then((t=>{console.log(t),this.getFavoriteSpots()})).catch((t=>{console.log(t)})))},checkLogin(){const t=document.cookie.replace(/(?:(?:^|.*;\s*)accessToken\s*=\s*([^;]*).*$)|^.*$/,"$1");if(t){this.$http.defaults.headers.common.Authorization=`Bearer ${t}`;const e="https://tourist-spots-backend.onrender.com/api/check-login";this.$http.post(e).then((t=>{console.log(t),this.checkSuccess=!0})).catch((t=>{console.log(t),"Token has expired"===t.response.data.msg&&(console.log("過期"),this.refreshToken())}))}else alert("尚未登入"),this.$router.push("/login")},refreshToken(){const t=document.cookie.replace(/(?:(?:^|.*;\s*)refreshToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=`Bearer ${t}`;const e="https://tourist-spots-backend.onrender.com/api/refresh";this.$http.post(e).then((e=>{console.log(e),document.cookie=`accessToken=${e.data.access_token}`,document.cookie=`refreshToken=${t}`,console.log(document.cookie),this.checkLogin()})).catch((t=>{console.log(t)}))}},mounted(){this.checkLogin(),this.getFavoriteSpots()}},$=o(3744);const m=(0,$.Z)(g,[["render",k]]);var f=m}}]);
//# sourceMappingURL=246.eb4d51f4.js.map