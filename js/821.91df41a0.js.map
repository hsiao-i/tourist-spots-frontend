{"version":3,"file":"js/821.91df41a0.js","mappings":"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","sources":["webpack://hexschool-project-frontend/./src/views/SingleTouristSpot.vue","webpack://hexschool-project-frontend/./src/views/SingleTouristSpot.vue?d4f7"],"sourcesContent":["<template>\n  <div class=\"container mt-5 min-vh-100\">\n    <h2>{{ touristSpot.position }}</h2>\n\n    <div class=\"mb-3\">\n      <button type=\"button\" class=\"btn btn-outline-secondary btn-sm\" @click=\"addFavoriteSpot\" v-if=\"alreadyFavorite\">收藏</button>\n      <button type=\"button\" class=\"btn btn-secondary btn-sm\" @click=\"deleteFavoriteSpot\" v-else>已收藏</button>\n    </div>\n\n    <p>{{ touristSpot.description }}</p>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      touristSpot: {},\n      alreadyFavorite: true,\n    };\n  },\n  methods: {\n    getTouristSpot() {\n      const { id } = this.$route.params;\n      const url = `${process.env.VUE_APP_API}/api/tourist-spot/${id}`;\n      this.$http\n        .get(url)\n        .then((res) => {\n          this.touristSpot = res.data.spot;\n          console.log(this.touristSpot);\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    },\n    addFavoriteSpot() {\n      // this.$http.defaults.withCredentials = true;\n      const { id } = this.$route.params;\n      const url = `${process.env.VUE_APP_API}/api/add-favorite/${id}`;\n      const token = document.cookie.replace(/(?:(?:^|.*;\\s*)accessToken\\s*=\\s*([^;]*).*$)|^.*$/, '$1');\n\n      if (token) {\n        this.$http.defaults.headers.common.Authorization = `Bearer ${token}`;\n\n        this.$http\n          .post(url)\n          .then((res) => {\n            console.log(res);\n            this.alreadyFavorite = false;\n          })\n          .catch((err) => {\n            console.log(err);\n            if (err.response.data.msg === 'Token has expired') {\n              console.log('過期');\n              this.refreshToken();\n              this.addFavoriteSpot();\n            }\n            // if (err.response.data.error.error === '不可重複加入景點') {\n            //   alert('此景點已被加入收藏');\n            // }\n          });\n      } else {\n        alert('請登入');\n        this.$router.push('/login');\n        console.log('沒有收到 token');\n      }\n    },\n    deleteFavoriteSpot() {\n      // this.alreadyFavorite = true;\n      const { id } = this.$route.params;\n      const url = `${process.env.VUE_APP_API}/api/delete-favorite/${id}`;\n\n      const token = document.cookie.replace(/(?:(?:^|.*;\\s*)accessToken\\s*=\\s*([^;]*).*$)|^.*$/, '$1');\n\n      if (token) {\n        this.$http.defaults.headers.common.Authorization = `Bearer ${token}`;\n\n        this.$http\n          .delete(url)\n          .then((res) => {\n            console.log(res);\n            this.getFavoriteList();\n          })\n          .catch((err) => {\n            console.log(err);\n            if (err.response.data.msg === 'Token has expired') {\n              console.log('過期');\n              this.refreshToken();\n              this.deleteFavoriteSpot(id);\n            }\n          });\n      }\n    },\n    getFavoriteList() {\n      const url = `${process.env.VUE_APP_API}/api/get-favorite`;\n\n      const token = document.cookie.replace(/(?:(?:^|.*;\\s*)accessToken\\s*=\\s*([^;]*).*$)|^.*$/, '$1');\n\n      if (token) {\n        this.$http.defaults.headers.common.Authorization = `Bearer ${token}`;\n\n        this.$http\n          .get(url)\n          .then((res) => {\n            console.log(res);\n            const isFavorite = res.data.favorite.map((item) => item.id);\n            this.alreadyFavorite = !isFavorite.includes(this.touristSpot.id);\n            // console.log(this.alreadyFavorite);\n          })\n          .catch((err) => {\n            console.log(err);\n            if (err.response.data.msg === 'Token has expired') {\n              console.log('過期');\n              this.refreshToken();\n              this.getFavoriteList();\n            }\n          });\n      }\n    },\n    refreshToken() {\n      const refreshToken = document.cookie.replace(/(?:(?:^|.*;\\s*)refreshToken\\s*=\\s*([^;]*).*$)|^.*$/, '$1');\n      this.$http.defaults.headers.common.Authorization = `Bearer ${refreshToken}`;\n      const refreshUrl = `${process.env.VUE_APP_API}/api/refresh`;\n\n      this.$http\n        .post(refreshUrl)\n        .then((res) => {\n          console.log(res);\n          document.cookie = `accessToken=${res.data.access_token}`;\n          document.cookie = `refreshToken=${refreshToken}`;\n\n          // this.checkLogin();\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    },\n  },\n\n  mounted() {\n    this.getTouristSpot();\n    this.getFavoriteList();\n  },\n};\n</script>\n\n<style></style>\n","import { render } from \"./SingleTouristSpot.vue?vue&type=template&id=f49fd674\"\nimport script from \"./SingleTouristSpot.vue?vue&type=script&lang=js\"\nexport * from \"./SingleTouristSpot.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"D:\\\\eva090029\\\\practice\\\\separate\\\\hexschool\\\\tourist-spots-frontend-main\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","$data","position","_hoisted_2","type","onClick","$options","description","data","touristSpot","alreadyFavorite","methods","getTouristSpot","id","this","$route","params","url","$http","get","then","res","spot","console","log","catch","err","addFavoriteSpot","token","document","cookie","replace","defaults","headers","common","Authorization","post","response","msg","refreshToken","alert","$router","push","deleteFavoriteSpot","delete","getFavoriteList","isFavorite","favorite","map","item","includes","refreshUrl","access_token","mounted","__exports__","render"],"sourceRoot":""}